
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>Index</h2>


<div ng-app="app" ng-controller="cont">

    <div class="row">

        <div class="col-sm-12">
            <div class="form-group form-group-sm">
                <button class="btn btn-primary" ng-click="showAddWaitingModal()"><span class="fa fa-plus-square"></span> Add</button>


            </div>

        </div>


 <!-- DISPLAY WAITING LIST -->
    <!-- DISPLAY WAITING LIST -->
       <!-- DISPLAY WAITING LIST -->


        <div class="col-sm-12">

            <div class="panel-primary">
                <div class="panel-heading">Waiting List</div>


                <table st-table="waitingListDisplay" st-safe-src="waitingList" class="small table table-striped table-bordered">
                    <thead>
                        <tr>

                            <th colspan="5"><input st-search="" class="input-sm form-control pull-right" placeholder="Search" type="text" /></th>
                        </tr>
                        <tr>

                            <th st-sort="PatientFullName" >Patient Full Name</th>
                            <th st-sort="Schedule"> Schedule</th>
                            <th>Remarks</th>
                            <th></th>
                           
                        </tr>
                    </thead>
                    <tbody>
                        <tr></tr>
                        <tr ng-repeat="row in waitingList">
                            <td>{{row.PatientFullName}}</td>
                            <td>{{row.Schedule}}</td>
                            <td>{{row.Remarks}}</td>
                            <td>
                                <button class="btn-xs btn btn-default" ng-click="showConfirmDeleteModal(row)"><span class="fa fa-remove"></span> Delete</button>
                                <button class="btn-xs btn btn-default" ng-click=""><span class="fa fa-pencil"></span> Edit</button>

                            </td>
                          
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="5" class="text-center">
                                <div st-pagination="" st-displayed-pages="5"></div>
                            </td>
                        </tr>
                    </tfoot>
                </table>

            </div>

        </div>


    </div>



<!----------------------------------------------->
    <!----------------------------------------------->
        <!----------------------------------------------->


  <!-- ADD WAITING LIST -->
        <!-- ADD WAITING LIST -->
            <!-- ADD WAITING LIST -->


    <div class="modal fade" id="addModal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Modal title</h4>
                </div>
                <div class="modal-body">

                    <input id="DateTimePicker" type="text" />


                    <table st-table="patientsListDisplay" st-safe-src="patientsList" class="table table-striped small">
                        <thead>
                            <tr>
                                <th colspan="5"><input st-search="" class="form-control" placeholder="global search ..." type="text" /></th>
                            </tr>
                            <tr>
                                <td>Full Name</td>
                                <td>Gender</td>
                                <td>Birth Date</td>
                            </tr>
                        </thead>
                        <tbody>
                            <tr></tr>
                            <tr ng-repeat="row in patientsList">
                                <td>{{row.FirstName + ' ' + row.MiddleName + " " + row.LastName}}</td>
                                <td>{{row.Gender}}</td>
                                <td>{{row.BirthDate}}</td>
                                <td>
                                    <button class="btn btn-success" ng-click="addWaiting(row.Id)">Add to Waiting List</button>

                                </td>
                            </tr>
                        </tbody>

                    </table>





                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->


    
    <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Modal title</h4>
                </div>
                <div class="modal-body">

                    <p id="dName"></p>

                </div>
                <div class="modal-footer">

                    <button type="button" class="btn btn-success" ng-click="DeleteWaiting()" data-dismiss="modal">Yes</button>
                    <button type="button" class="btn btn-success" data-dismiss="modal">No</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->




</div>


@section Scripts{


    <script src="~/.bin/bower_components/angular-smart-table/dist/smart-table.min.js"></script>

    <script>

        angular.module('app', ['smart-table'], function () { })
        .controller('cont', function ($scope, $http) {


            //GET WAITINGLIST

            $scope.waitingList = [];
            $scope.waitingListDisplay = [].concat($scope.waitingList);

            $http({
                method: 'GET',
                url: '/Waiting/getWaitingPatients'
            }).success(function (data) {

                $scope.waitingList = data;

            }, function errorCallback(data) {

            });


            //ADD WAITING PATIENT

            $scope.patientsList = [];
            $scope.patientsListDisplay = [].concat($scope.patientsList);

            $scope.showAddWaitingModal = function () {

                $('#addModal').modal('toggle');

                $http({
                    method: 'GET',
                    url: '/Patients/getPatients'
                }).success(function (data) {

                    $scope.patientsList = data;

                }, function errorCallback(data) {

                });

            }


            $scope.addWaiting = function (Id) {

                $scope.waitingModel = {
                    'Id': '',
                    'PatientId': Id,
                    'Schedule': $('#DateTimePicker').val(),
                    'Remarks': ''

                };

                $http({
                    method: 'POST',
                    url: '/Waiting/addWaitingPatient',
                    data: $.param({ patient: $scope.waitingModel }),
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                }).success(function (data) {

                    
                    $scope.waitingList.push(data);

                });

            };


            //DELETE WAITING PATIENTS


            $scope.selectedWaitingRow;

            $scope.showConfirmDeleteModal = function (row) {

                $scope.selectedWaitingRow = row;

                $('#deleteModal').modal('toggle');

                $('#dName').text(row.PatientFullName);


            }

            $scope.DeleteWaiting = function () {

                
                $http({
                    method: 'GET',
                    url: '/Waiting/deleteWaitingPatient?id='+ $scope.selectedWaitingRow.Id +''
                }).success(function (data) {

                    if (data == "ok") {

                        var index = $scope.waitingList.indexOf($scope.selectedWaitingRow);

                        $scope.waitingList.splice(index, 1);
                    }

                }, function errorCallback(data) {

                });


            };


        });

    </script>


}